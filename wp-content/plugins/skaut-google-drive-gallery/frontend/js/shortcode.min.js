jQuery( function( $ ) {
!function(){"use strict";var t={n:function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,{a:i}),i},d:function(e,i){for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e=require("justified-layout"),i=t.n(e);function o(t){return"error"in t}var a=function(){function t(t,e){this.hash=t,this.name=e}return t.prototype.get=function(){var t=new RegExp("[?&]sgdg-"+this.name+"-"+this.hash+"=(([^&#]*)|&|#|$)").exec(document.location.search);return void 0===(null==t?void 0:t[2])?"":decodeURIComponent(t[2].replace(/\+/g," "))},t.prototype.remove=function(){var t=window.location.search,e=new RegExp("\\?sgdg-"+this.name+"-"+this.hash+"=[^&]*"),i=new RegExp("&sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t&&(t=(t=t.replace(e,"?")).replace(i,"")),window.location.pathname+t},t.prototype.add=function(t){var e=window.location.search,i="sgdg-"+this.name+"-"+this.hash+"="+t,o="?"+i,a=new RegExp("([?&])sgdg-"+this.name+"-"+this.hash+"=[^&]*");return t?(e&&(o=null!==a.exec(e)?e.replace(a,"$1"+i):e+"&"+i),window.location.pathname+o):this.remove()},t}(),r=function(){function t(t,e){var i=this;this.lightbox=$(),this.hasMore=!1,this.path="",this.lastPage=1,this.loading=!1,this.container=$(t),this.hash=e,this.shortHash=e.substring(0,8),this.pageQueryParameter=new a(this.shortHash,"page"),this.pathQueryParameter=new a(this.shortHash,"path"),this.path=this.pathQueryParameter.get(),this.get(),$(window).on("popstate",(function(){i.init()})),$(window).on("resize",(function(){i.reflow()}))}return t.prototype.onLightboxNavigation=function(t){var e=$(t).data("sgdg-page"),i=$(t).parent().children().length;history.replaceState(history.state,"",this.pageQueryParameter.add(e)),"true"===sgdgShortcodeLocalize.page_autoload&&this.hasMore&&$(t).index()>=Math.min(i-2,Math.floor(.9*i))&&this.add()},t.prototype.onLightboxQuit=function(){history.replaceState(history.state,"",this.pageQueryParameter.remove())},t.prototype.reflow=function(){var t=this,e=[],o=[];this.container.find(".sgdg-gallery").children().each((function(t,i){$(i).css("display","inline-block");var a=i.firstChild,r=a.naturalWidth/a.naturalHeight;if(0<$(i).find("svg").length){var n=$(i).find("svg")[0].getBBox();r=n.width/n.height}$(i).hasClass("sgdg-grid-square")&&(r=1),isNaN(r)?e[t]=!1:(e[t]=!0,o.push(r)),$(i).css("position","absolute")})),0<o.length&&this.container.find(".sgdg-loading").remove();var a=i()(o,{containerWidth:this.container.find(".sgdg-gallery").width(),containerPadding:{top:10,left:0,right:0,bottom:0},boxSpacing:parseInt(sgdgShortcodeLocalize.grid_spacing),targetRowHeight:parseInt(sgdgShortcodeLocalize.grid_height),targetRowHeightTolerance:.15,edgeCaseMinRowHeight:0}),r=0;this.container.find(".sgdg-gallery").children().each((function(i,o){if(e[i]){var n=a.boxes[r],s=t.container.find(".sgdg-gallery").position();$(o).css("top",n.top+s.top),$(o).css("left",n.left+s.left),$(o).width(n.width),$(o).height(n.height),r++}else $(o).css("display","none")})),this.container.find(".sgdg-gallery").height(a.containerHeight)},t.prototype.reflowTimer=function(){var t=this;n.reflowAll(),this.loading&&setTimeout((function(){t.reflowTimer()}),250)},t.prototype.init=function(){var t=this.pathQueryParameter.get();this.path!==t&&(this.path=t,this.get())},t.prototype.get=function(){var t=this;this.path=this.pathQueryParameter.get(),this.lastPage=parseInt(this.pageQueryParameter.get())||1,this.lightbox=$().imageLightbox({allowedTypes:"",animationSpeed:parseInt(sgdgShortcodeLocalize.preview_speed,10),activity:"true"===sgdgShortcodeLocalize.preview_activity,arrows:"true"===sgdgShortcodeLocalize.preview_arrows,button:"true"===sgdgShortcodeLocalize.preview_closebutton,fullscreen:!0,gutter:0,history:!0,overlay:!0,caption:"true"===sgdgShortcodeLocalize.preview_captions,quitOnEnd:"true"===sgdgShortcodeLocalize.preview_quitOnEnd}),this.container.find(".sgdg-gallery").replaceWith('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),n.reflowAll(),$.get(sgdgShortcodeLocalize.ajax_url,{action:"gallery",hash:this.hash,path:this.path,page:this.lastPage},(function(e){o(e)?t.container.html(e.error):t.getSuccess(e)}))},t.prototype.getSuccess=function(t){var e,i,o=this,a=((t.directories?t.directories.length:0)+(t.images?t.images.length:0)+(t.videos?t.videos.length:0))/this.lastPage,r="",n=1,s=a;(t.path&&0<t.path.length||t.directories&&0<t.directories.length)&&(r+=this.renderBreadcrumbs(null!==(e=t.path)&&void 0!==e?e:[])),t.directories&&0<t.directories.length||t.images&&0<t.images.length||t.videos&&0<t.videos.length?(r+='<div class="sgdg-loading"><div></div></div><div class="sgdg-gallery">',t.directories&&$.each(t.directories,(function(t,e){r+=o.renderDirectory(e),0===--s&&(s=a,n++)})),t.images&&$.each(t.images,(function(t,e){r+=o.renderImage(n,e),0===--s&&(s=a,n++)})),t.videos&&$.each(t.videos,(function(t,e){""!==document.createElement("video").canPlayType(e.mimeType)&&(r+=o.renderVideo(n,e)),0===--s&&(s=a,n++)})),r+="</div>",!0===t.more&&(r+=this.renderMoreButton())):r+='<div class="sgdg-gallery">'+sgdgShortcodeLocalize.empty_gallery+"</div>",this.container.html(r),this.hasMore=null!==(i=t.more)&&void 0!==i&&i,this.postLoad(),this.lightbox.openHistory()},t.prototype.add=function(){var t=this;this.lastPage+=1,this.container.find(".sgdg-gallery").after('<div class="sgdg-loading"><div></div></div>'),this.container.find(".sgdg-more-button").remove(),$.get(sgdgShortcodeLocalize.ajax_url,{action:"page",hash:this.hash,path:this.pathQueryParameter.get(),page:this.lastPage},(function(e){if(o(e))return t.container.find(".sgdg-loading").replaceWith(e.error),void t.container.find(".sgdg-more-button").remove();t.addSuccess(e)}))},t.prototype.addSuccess=function(t){var e,i=this,o="";$.each(t.directories,(function(t,e){o+=i.renderDirectory(e)})),$.each(t.images,(function(t,e){o+=i.renderImage(i.lastPage,e)})),$.each(t.videos,(function(t,e){o+=i.renderVideo(i.lastPage,e)})),this.container.find(".sgdg-gallery").append(o),this.hasMore=null!==(e=t.more)&&void 0!==e&&e,!0===t.more&&this.container.append(this.renderMoreButton()),this.container.find(".sgdg-loading").remove(),this.postLoad()},t.prototype.postLoad=function(){var t=this;this.container.find("a[data-sgdg-path]").off("click.sgdg").on("click.sgdg",(function(e){return history.pushState({},"",t.pathQueryParameter.add($(e.currentTarget).data("sgdgPath"))),t.get(),!1})),this.container.find(".sgdg-more-button").on("click",(function(){return t.add(),!1})),this.loading=!0,this.container.find(".sgdg-gallery").imagesLoaded({background:!0},(function(){t.loading=!1,n.reflowAll()})),this.reflowTimer(),this.lightbox.addToImageLightbox(this.container.find("a[data-imagelightbox]")),"true"===sgdgShortcodeLocalize.page_autoload&&$(window).off("scroll.sgdg").on("scroll.sgdg",(function(e){var i=$(".sgdg-more-button");void 0!==i.offset()&&($(e.currentTarget).scrollTop()+$(window).height()>i.offset().top+i.outerHeight()&&!t.loading&&t.add())}))},t.prototype.renderBreadcrumbs=function(t){var e=this,i='<div><a data-sgdg-path="" href="'+this.pathQueryParameter.remove()+'">'+sgdgShortcodeLocalize.breadcrumbs_top+"</a>",o="";return $.each(t,(function(t,a){o+=a.id,i+=' > <a data-sgdg-path="'+o+'" href="'+e.pathQueryParameter.add(o)+'">'+a.name+"</a>",o+="/"})),i+="</div>"},t.prototype.renderDirectory=function(t){var e=this.pathQueryParameter.get(),i='<a class="sgdg-grid-a sgdg-grid-square" data-sgdg-path="'+(e=(e?e+"/":"")+t.id)+'" href="'+this.pathQueryParameter.add(e)+'"';if(t.thumbnail?i+=" style=\"background-image: url('"+t.thumbnail+"');\">":i+='><svg class="sgdg-dir-icon" x="0px" y="0px" focusable="false" viewBox="0 0 24 24" fill="#8f8f8f"><path d="M10 4H4c-1.1 0-2 .9-2 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"></path></svg>',i+='<div class="sgdg-dir-overlay"><div class="sgdg-dir-name">'+t.name+"</div>",void 0!==t.dircount&&(i+='<span class="sgdg-count-icon dashicons dashicons-category"></span> '+t.dircount.toString()+(1e3===t.dircount?"+":"")),void 0!==t.imagecount){var o="";void 0!==t.dircount&&(o=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-format-image'+o+'"></span> '+t.imagecount.toString()+(1e3===t.imagecount?"+":"")}if(void 0!==t.videocount){o="";void 0===t.dircount&&void 0===t.imagecount||(o=" sgdg-count-icon-indent"),i+='<span class="sgdg-count-icon dashicons dashicons-video-alt3'+o+'"></span> '+t.videocount.toString()+(1e3===t.videocount?"+":"")}return i+="</div></a>"},t.prototype.renderImage=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-ilb2-caption="'+e.description+'" data-sgdg-page="'+t.toString()+'" href="'+e.image+'"><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},t.prototype.renderVideo=function(t,e){return'<a class="sgdg-grid-a" data-imagelightbox="'+this.shortHash+'" data-ilb2-id="'+e.id+'" data-sgdg-page="'+t.toString()+'" data-ilb2-video=\'{ "controls": "controls", "autoplay": "autoplay", "height": '+("number"==typeof e.height?e.height.toString():"0")+', "width": '+("number"==typeof e.width?e.width.toString():"0")+', "sources": [ { "src": "'+e.src+'", "type": "'+e.mimeType+'" } ] }\'><img class="sgdg-grid-img" src="'+e.thumbnail+'"></a>'},t.prototype.renderMoreButton=function(){return'<div class="sgdg-more-button"><div>'+sgdgShortcodeLocalize.load_more+"</div></div>"},t}(),n={shortcodes:{},init:function(){var t=this;$(".sgdg-gallery-container").each((function(e,i){var o=$(i).data("sgdgHash");void 0!==o&&(t.shortcodes[o.substring(0,8)]=new r(i,o))})),$(document).on("start.ilb2 next.ilb2 previous.ilb2",(function(e,i){t.onLightboxNavigation(i)})),$(document).on("quit.ilb2",(function(){t.onLightboxQuit()}))},reflowAll:function(){$.each(this.shortcodes,(function(t,e){e.reflow()}))},onLightboxNavigation:function(t){var e=$(t).data("imagelightbox");this.shortcodes[e].onLightboxNavigation(t)},onLightboxQuit:function(){$.each(this.shortcodes,(function(t,e){e.onLightboxQuit()}))}};n.init()}();} );
